# Bitwarden (Vaultwarden) ä¸€é”®å®‰è£…è„šæœ¬

ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„Bitwardenå¯†ç ç®¡ç†å™¨è‡ªæ‰˜ç®¡è§£å†³æ–¹æ¡ˆï¼ŒåŸºäºVaultwardenï¼Œæ”¯æŒIPv4/IPv6åŒæ ˆï¼ŒåŒ…å«è‡ªåŠ¨å¤‡ä»½ã€é€šçŸ¥æé†’ç­‰åŠŸèƒ½ã€‚

## ğŸš€ åŠŸèƒ½ç‰¹æ€§

### æ ¸å¿ƒåŠŸèƒ½
- âœ… **VaultwardenæœåŠ¡å™¨** - Bitwarden APIå…¼å®¹çš„è½»é‡çº§å®ç°
- âœ… **è‡ªåŠ¨SSLè¯ä¹¦** - é€šè¿‡Caddyè‡ªåŠ¨è·å–Let's Encryptè¯ä¹¦
- âœ… **IPv4/IPv6åŒæ ˆæ”¯æŒ** - æ™ºèƒ½æ£€æµ‹å¹¶åº”ç”¨ä¼˜åŒ–é…ç½®
- âœ… **WebSocketæ”¯æŒ** - å®æ—¶å¯†ç åº“åŒæ­¥é€šçŸ¥

### å¤‡ä»½ä¸æ¢å¤
- ğŸ”„ **è‡ªåŠ¨å®šæ—¶å¤‡ä»½** - æ¯å¤©å‡Œæ™¨2ç‚¹è‡ªåŠ¨å¤‡ä»½
- â˜ï¸ **Cloudflare R2å­˜å‚¨** - æ”¯æŒåŒR2è´¦æˆ·å†—ä½™å¤‡ä»½
- ğŸ” **åŠ å¯†å¤‡ä»½** - AES-256åŠ å¯†ä¿æŠ¤å¤‡ä»½æ•°æ®
- ğŸ“… **æœ¬åœ°ä¿ç•™ç­–ç•¥** - è‡ªåŠ¨æ¸…ç†7å¤©å‰çš„å¤‡ä»½

### é€šçŸ¥ç³»ç»Ÿ
- ğŸ“± **Telegramé€šçŸ¥** - å¤‡ä»½å®Œæˆ/å¤±è´¥é€šçŸ¥
- ğŸ“§ **é‚®ä»¶é€šçŸ¥** - SMTPé‚®ä»¶é€šçŸ¥
- ğŸ”” **å¤šé€šçŸ¥æ¸ é“** - å¯åŒæ—¶å¯ç”¨å¤šç§é€šçŸ¥æ–¹å¼

### ç®¡ç†åŠŸèƒ½
- ğŸ›ï¸ **Webç®¡ç†é¢æ¿** - é€šè¿‡ `bw-manage` å‘½ä»¤ç®¡ç†
- ğŸ“Š **æœåŠ¡çŠ¶æ€ç›‘æ§** - å®æ—¶æŸ¥çœ‹å®¹å™¨çŠ¶æ€å’Œæ—¥å¿—
- ğŸ”§ **ä¸€é”®ä¿®å¤å·¥å…·** - IPv6è¿æ¥é—®é¢˜å¿«é€Ÿä¿®å¤
- ğŸ”„ **æœåŠ¡æ›´æ–°** - ä¸€é”®æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬

## ğŸ“‹ ç³»ç»Ÿè¦æ±‚

- **æ“ä½œç³»ç»Ÿ**: Ubuntu 20.04+, Debian 10+, CentOS 8+
- **å†…å­˜**: è‡³å°‘1GB RAM
- **å­˜å‚¨**: è‡³å°‘10GBå¯ç”¨ç©ºé—´
- **ç½‘ç»œ**: å…¬ç½‘IPï¼ˆIPv4æˆ–IPv6ï¼‰ï¼Œå¼€æ”¾80/443ç«¯å£
- **åŸŸå**: æœ‰æ•ˆçš„åŸŸåï¼ˆç”¨äºSSLè¯ä¹¦ï¼‰

## ğŸ› ï¸ å¿«é€Ÿå¼€å§‹

### 1. ä¸‹è½½è„šæœ¬
```bash
curl -L -o setup.sh https://raw.githubusercontent.com/sikiyz/bitwarden-auto/main/setup.sh
chmod +x setup.sh
```

### 2. è¿è¡Œå®‰è£…
```bash
./setup.sh
```

### 3. æŒ‰ç…§å‘å¯¼é…ç½®
å®‰è£…è„šæœ¬ä¼šå¼•å¯¼ä½ å®Œæˆä»¥ä¸‹é…ç½®ï¼š
- åŸŸåè®¾ç½®
- é‚®ç®±åœ°å€ï¼ˆç”¨äºSSLè¯ä¹¦ï¼‰
- ç«¯å£é…ç½®
- IPç‰ˆæœ¬é€‰æ‹©ï¼ˆIPv4/IPv6ï¼‰
- é€šçŸ¥æ–¹å¼è®¾ç½®
- Cloudflare R2å¤‡ä»½é…ç½®

## âš™ï¸ è¯¦ç»†é…ç½®è¯´æ˜

### åŸŸåé…ç½®
- éœ€è¦æœ‰æ•ˆçš„åŸŸåï¼Œå¦‚ `vault.yourdomain.com`
- åŸŸåå¿…é¡»æ­£ç¡®è§£æåˆ°æœåŠ¡å™¨IPåœ°å€
- å»ºè®®ä½¿ç”¨å­åŸŸåï¼Œé¿å…ä¸ä¸»ç«™å†²çª

### ç«¯å£é…ç½®
| ç«¯å£ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| Vaultwarden Web | 8080 | å†…éƒ¨ç®¡ç†ç«¯å£ |
| WebSocket | 3012 | å®æ—¶é€šçŸ¥ç«¯å£ |
| HTTP | 80 | å¤–éƒ¨HTTPè®¿é—®ç«¯å£ |
| HTTPS | 443 | å¤–éƒ¨HTTPSè®¿é—®ç«¯å£ |

### IPç‰ˆæœ¬é€‰æ‹©
- **IPv4**: æ ‡å‡†é…ç½®ï¼Œé€‚ç”¨äºå¤§å¤šæ•°æœåŠ¡å™¨
- **IPv6**: ä¼˜åŒ–é…ç½®ï¼Œé€‚ç”¨äºçº¯IPv6æœåŠ¡å™¨
  - è‡ªåŠ¨åº”ç”¨IPv6ç»‘å®šä¼˜åŒ–
  - ä¿®å¤Caddy IPv6å…¼å®¹æ€§é—®é¢˜
  - æ”¯æŒIPv6ç›´æ¥è®¿é—®

### Cloudflare R2é…ç½®
éœ€è¦å‡†å¤‡ä»¥ä¸‹ä¿¡æ¯ï¼š
1. Cloudflare Account ID
2. R2 Access Key ID
3. R2 Secret Access Key
4. R2 Bucketåç§°

æ”¯æŒé…ç½®ä¸¤ä¸ªR2è´¦æˆ·ï¼Œå®ç°å¤‡ä»½å†—ä½™ã€‚

## ğŸ® ç®¡ç†å‘½ä»¤

### ä¸»ç®¡ç†å‘½ä»¤
```bash
bw-manage
```

### å¸¸ç”¨æ“ä½œ
```bash
# å¯åŠ¨æœåŠ¡
bw-manage start

# åœæ­¢æœåŠ¡
bw-manage stop

# é‡å¯æœåŠ¡
bw-manage restart

# æŸ¥çœ‹çŠ¶æ€
bw-manage status

# æŸ¥çœ‹æ—¥å¿—
bw-manage logs

# æ‰‹åŠ¨å¤‡ä»½
bw-manage backup

# æµ‹è¯•é€šçŸ¥
bw-manage test-notification

# æ›´æ–°æœåŠ¡
bw-manage update

# IPv6è¯Šæ–­
bw-manage diagnose-ipv6
```

### ç‹¬ç«‹è„šæœ¬
```bash
# æ‰‹åŠ¨å¤‡ä»½
/opt/bitwarden/backup.sh

# æ¢å¤å¤‡ä»½
/opt/bitwarden/restore.sh

# å¸è½½æœåŠ¡ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰
/opt/bitwarden/manage.sh  # é€‰æ‹©å¸è½½é€‰é¡¹
```

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. æ— æ³•è®¿é—®HTTPS
```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹Caddyæ—¥å¿—
docker-compose logs caddy

# æ£€æŸ¥é˜²ç«å¢™
sudo ufw status
```

#### 2. IPv6è¿æ¥é—®é¢˜
```bash
# è¿è¡ŒIPv6è¯Šæ–­
bw-manage diagnose-ipv6

# å¿«é€Ÿä¿®å¤IPv6
./install-bitwarden.sh --fix-ipv6

# æµ‹è¯•IPv6è¿æ¥
curl -6 -v -k https://your-domain.com
```

#### 3. è¯ä¹¦è·å–å¤±è´¥
```bash
# æ£€æŸ¥åŸŸåè§£æ
nslookup your-domain.com

# æ£€æŸ¥80/443ç«¯å£æ˜¯å¦å¼€æ”¾
sudo netstat -tlnp | grep -E ':(80|443)'

# æ¸…ç†Caddyè¯ä¹¦ç¼“å­˜
rm -rf /opt/bitwarden/caddy_data/*
docker-compose restart caddy
```

#### 4. å¤‡ä»½å¤±è´¥
```bash
# æ£€æŸ¥R2é…ç½®
cat /opt/bitwarden/config.env | grep CF_

# æ‰‹åŠ¨æµ‹è¯•R2è¿æ¥
/opt/bitwarden/backup.sh

# æŸ¥çœ‹å¤‡ä»½æ—¥å¿—
tail -f /var/log/bitwarden_backup.log
```

### æ—¥å¿—ä½ç½®
- **Vaultwardenæ—¥å¿—**: `/opt/bitwarden/data/vaultwarden.log`
- **Caddyè®¿é—®æ—¥å¿—**: `/opt/bitwarden/caddy_data/access.log`
- **å¤‡ä»½æ—¥å¿—**: `/var/log/bitwarden_backup.log`
- **Dockerå®¹å™¨æ—¥å¿—**: `docker-compose logs`

## ğŸ”„ æ›´æ–°ä¸ç»´æŠ¤

### æ›´æ–°æœåŠ¡
```bash
cd /opt/bitwarden
docker-compose pull
docker-compose down
docker-compose up -d
```

### æ•°æ®å¤‡ä»½ä¸è¿ç§»
1. **å¤‡ä»½æ•°æ®**:
   ```bash
   /opt/bitwarden/backup.sh
   ```

2. **è¿ç§»åˆ°æ–°æœåŠ¡å™¨**:
   - åœ¨æ–°æœåŠ¡å™¨è¿è¡Œå®‰è£…è„šæœ¬
   - å°†å¤‡ä»½æ–‡ä»¶å¤åˆ¶åˆ°æ–°æœåŠ¡å™¨
   - è¿è¡Œæ¢å¤è„šæœ¬: `/opt/bitwarden/restore.sh`

### ç›‘æ§ä¸ç»´æŠ¤
```bash
# æŸ¥çœ‹èµ„æºä½¿ç”¨
docker stats

# æ¸…ç†Dockerç¼“å­˜
docker system prune -f

# æ£€æŸ¥ç£ç›˜ç©ºé—´
df -h /opt/bitwarden
```

## ğŸ“ ç›®å½•ç»“æ„
```
/opt/bitwarden/
â”œâ”€â”€ data/                 # Vaultwardenæ•°æ®ç›®å½•
â”œâ”€â”€ backups/              # æœ¬åœ°å¤‡ä»½æ–‡ä»¶
â”œâ”€â”€ caddy_data/          # Caddyè¯ä¹¦å’Œæ•°æ®
â”œâ”€â”€ caddy_config/        # Caddyé…ç½®
â”œâ”€â”€ config/              # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ Caddyfile        # Caddyé…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ vaultwarden.env  # Vaultwardenç¯å¢ƒå˜é‡
â”œâ”€â”€ docker-compose.yml   # Docker Composeé…ç½®
â”œâ”€â”€ config.env           # ä¸»é…ç½®æ–‡ä»¶
â”œâ”€â”€ backup.sh           # å¤‡ä»½è„šæœ¬
â”œâ”€â”€ restore.sh          # æ¢å¤è„šæœ¬
â””â”€â”€ manage.sh           # ç®¡ç†è„šæœ¬
```

## ğŸ”’ å®‰å…¨å»ºè®®

### 1. é˜²ç«å¢™é…ç½®
```bash
# åªå¼€æ”¾å¿…è¦ç«¯å£
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw enable
```

### 2. å®šæœŸæ›´æ–°
```bash
# æ¯å‘¨æ£€æŸ¥æ›´æ–°
docker-compose pull
```

### 3. ç›‘æ§è®¿é—®æ—¥å¿—
```bash
# æŸ¥çœ‹å¼‚å¸¸è®¿é—®
tail -f /opt/bitwarden/caddy_data/access.log | grep -v "200\|304"
```

### 4. å¼ºå¯†ç ç­–ç•¥
- ä½¿ç”¨å¤æ‚çš„ç®¡ç†å‘˜ä»¤ç‰Œ
- å¯ç”¨ä¸¤æ­¥éªŒè¯
- å®šæœŸæ›´æ¢å¯†ç 

## ğŸŒ ç½‘ç»œé…ç½®

### IPv4æœåŠ¡å™¨
- ç¡®ä¿80/443ç«¯å£å¯¹å¤–å¼€æ”¾
- åŸŸåAè®°å½•æŒ‡å‘æœåŠ¡å™¨IPv4åœ°å€
- é˜²ç«å¢™å…è®¸HTTP/HTTPSæµé‡

### IPv6æœåŠ¡å™¨
- ç¡®ä¿IPv6åœ°å€æ­£ç¡®é…ç½®
- åŸŸåAAAAè®°å½•æŒ‡å‘æœåŠ¡å™¨IPv6åœ°å€
- å…³é—­Cloudflareä»£ç†ï¼ˆä½¿ç”¨ç°è‰²äº‘ï¼‰
- é˜²ç«å¢™å…è®¸IPv6 HTTP/HTTPSæµé‡

### Cloudflareç”¨æˆ·
- **IPv4æœåŠ¡å™¨**: å¯å¼€å¯ä»£ç†ï¼ˆæ©™è‰²äº‘ï¼‰
- **IPv6æœåŠ¡å™¨**: å¿…é¡»å…³é—­ä»£ç†ï¼ˆç°è‰²äº‘ï¼‰
- ç¡®ä¿SSL/TLSè®¾ç½®ä¸º"å®Œå…¨"æˆ–"ä¸¥æ ¼"

## ğŸ¤ è´¡çŒ®ä¸æ”¯æŒ

### æŠ¥å‘Šé—®é¢˜
1. æ£€æŸ¥ç°æœ‰Issueæ˜¯å¦å·²è§£å†³
2. æä¾›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
3. åŒ…å«ç›¸å…³æ—¥å¿—å’Œé…ç½®

### åŠŸèƒ½è¯·æ±‚
1. æè¿°å…·ä½“éœ€æ±‚
2. è¯´æ˜ä½¿ç”¨åœºæ™¯
3. æä¾›ç›¸å…³å‚è€ƒèµ„æ–™

### å¼€å‘è´¡çŒ®
1. Forkä»“åº“
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. æäº¤Pull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®åŸºäºMITè®¸å¯è¯å¼€æºã€‚è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶ã€‚

## ğŸ™ è‡´è°¢

- [Vaultwarden](https://github.com/dani-garcia/vaultwarden) - è½»é‡çº§BitwardenæœåŠ¡å™¨
- [Caddy](https://caddyserver.com/) - ç°ä»£åŒ–çš„WebæœåŠ¡å™¨
- [Docker](https://www.docker.com/) - å®¹å™¨åŒ–å¹³å°
- [Cloudflare R2](https://www.cloudflare.com/products/r2/) - å¯¹è±¡å­˜å‚¨æœåŠ¡

## ğŸ“ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š
- GitHub Issues: [é¡¹ç›®Issuesé¡µé¢](https://github.com/sikiyz/bitwarden-auto/issues)
- telegram : [TGè”ç³»âœˆï¸](https://t.me/sikichat_bot) 

---

**âš ï¸ å…è´£å£°æ˜**: æœ¬è„šæœ¬ä»…ä¾›å­¦ä¹ å’Œç ”ç©¶ä½¿ç”¨ï¼Œä½œè€…ä¸å¯¹ä½¿ç”¨æœ¬è„šæœ¬é€ æˆçš„ä»»ä½•æ•°æ®ä¸¢å¤±æˆ–å®‰å…¨é—®é¢˜è´Ÿè´£ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨å‰ï¼Œè¯·å……åˆ†æµ‹è¯•å¹¶å¤‡ä»½é‡è¦æ•°æ®ã€‚

**ğŸ”„ æœ€åæ›´æ–°**: 2024å¹´1æœˆ21æ—¥  
**ğŸ”— é¡¹ç›®åœ°å€**: [https://github.com/sikiyz/bitwarden-auto](https://github.com/sikiyz/bitwarden-auto)
